{% extends "website/new-base.html" %}
{% block content %}
<p>
    <strong>Captain:</strong> {{team.captain}}<br/>
    <strong>League:</strong> {{team.league}}<br/>
    <strong>Record:</strong> {{team.wins}} - {{team.losses}} - {{team.ties}}<br/>
</p>

<h4>
    Roster
    {% if not team_authorization.pending_request and not team_authorization.on_team %}
        <button class="btn btn-success" id="join_team" onclick="joinTeam('{{ url_for ('request_to_join_team', team_id=team_id) }}')">
            Join Team
        </button>
    {% endif %}
</h4>
<ul class="listgroup leadersList">
    {% for player in team.players %}
        <li class="list-group-item leaderPoint">
            {{player}}
        </li>
    {% endfor %}
</ul>

{% if team_authorization.is_captain and team_requests|length > 0 %}
    <h4>
        Team Requests
    </h4>
    {% for league_request in team_requests %}
        <div id="league_request{{request.id}}" class="row column-padding">
            <div class="col-xs-4">
                <label>
                    {{league_request.email}}
                    <br>to join {{league_request.team.team_name}}
                    <br>
                    {% if league_request.gender == 'f' %}
                        <small>Eligible for sapporo singles</small>
                    {% endif %}
                </label>
            </div>
            <div class="col-xs-4">
                <button
                    class="btn btn-info"
                    id="acceptRequest{{league_request.id}}"
                    onclick="respondToRequest('{{ url_for ('captain_respond_league_request', team_id=team_id, request_id=league_request.id) }}', true, 'league_request{{request.id}}')">
                    Accept
                </button>
            </div>
            <div class="col-xs-4">
                <button
                    class="btn btn-warning"
                    id="rejectRequest{{league_request.id}}"
                    onclick="respondToRequest('{{ url_for ('captain_respond_league_request', team_id=team_id, request_id=league_request.id) }}', false, 'league_request{{request.id}}');">
                    Decline
                </button>
            </div>
        </div>
    {% endfor %}
{% endif %}

<h4>
    Stats
</h4>
<table class="display" id="teamTable" cellspacing="0" width="100%">
    <thead>
        <th data-priority="1">Player</th>
        <th>Ave.</th>
        <th>SP</th>
        <th>S</th>
        <th data-priority="3">SS</th>
        <th>D</th>
        <th data-priority="2">HR</th>
        <th>AB</th>
    </thead>
    <tbody>
        {% for player in team.stats %}
            <tr>
                <td><a href="{{route.playerpage}}/{{year}}/{{player.id}}">{{player.name}}</a></td>
                <td>{{player.ba}}</td>
                <td>{{player.sp}}</td>
                <td>{{player.s}}</td>
                <td>{{player.ss}}</td>
                <td>{{player.d}}</td>
                <td>{{player.hr}}</td>
                <td>{{player.bats}}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
{% block script %}
<script>
    $(document).ready(ready());
    function ready(){
        $('#teamTable').DataTable({
            "order": [[6, "desc"]],
            "responsive": true
        });
    }
    function respondToRequest(url, value, element){
        var data = {"accept": value};
        $.ajax({
            type: "POST",
                url: url,
                contentType: "application/json",
                dataType: 'json',
                async: false,
                data: JSON.stringify(data),
                success: function (success){
                    if (success != true){
                        alert("Unable to respond to team request");
                    }
                    $('#' + element).hide();
                }, error: function(request, error){
                    alert("Error on submission")
                    console.log(request);
                    console.log(error);
                }
        });
    }
    function joinTeam(url) {
        $.ajax({
            type: "POST",
                url: url,
                contentType: "application/json",
                dataType: 'json',
                async: false,
                success: function (success){
                    $('#join_team').hide();
                }, error: function(request, error){
                    alert("Failed while trying to make team request");
                    console.log(request);
                    console.log(error);
                }
        });
    }
</script>
{% endblock %}