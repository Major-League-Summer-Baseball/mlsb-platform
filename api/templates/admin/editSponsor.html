{% extends "admin/admin_base.html" %}
{% block content %}
<table id="myTable" class="table table-bordered table-striped">
	<thead>
		<th>ID</td>
		<th>Name</th>
		<th>
			<button type="button" class="btn btn-warning" onclick="putSponsors();" id="updateButton" disabled>
				Update Sponsors
			</button>
		</th>
	</thead>
	<tbody id="sponsorTable" >
		{% for entry in sponsors %}
			<tr class="sponsorEntry" id="{{entry.sponsor_id}}">
				<td>
					{{entry.sponsor_id}}
				</td>
				<td>
					<input class="input" value="{{entry.sponsor_name}}" id='{{entry.sponsor_id}}_sponsor_name' onchange="change({{entry.sponsor_id}}, 'sponsor_name');">
				</td>
				<td>
					<button type="button" class="btn btn-danger" onclick="deleteSponsor({{entry.sponsor_id}});">
						Delete
					</button>
				</td>
			</tr>
		{% endfor %}
	</tbody>
	<tfoot>
		<tr>
			<td>
				<button  type="button" class="btn btn-info" onclick="postSponsor()">
					Add Sponsor
				</button>
			</td>
			<td>
				<input  type="text" class="newSponsor" value="" id="newName" placeholder="Sponsor">
			</td>
			<td></td>
		</tr>
	</tfoot>
<table>

<script>
var updates = {};

function postSponsor(){
	console.log("Fucker");
	var sponsor_name;
	sponsor_name = $("#newName").val();
	var data = { "sponsor_name":sponsor_name };
	$.ajax
	({
	  type: "POST",
	  url: "{{route.sponsor}}",
	  contentType: "application/json",
	  dataType: 'json',
	  async: false,
	  username: '{{admin}}',
	  password: '{{password}}',
	  data: JSON.stringify(data),
      dataType: "json",
	  success: function (results){
	  	if (results.success == true){
	  		alert('Sponsor was added successfully');
	  		var i1, i4;
	  		i1 = '<input class="input" value="' + results.data.sponsor_name + '" id="' + results.data.sponsor_id + '_sponsor_name" onclick="change('+ results.data.sponsor_id+', \'sponsor_name\')">';
	  		i4 = '	<button type="button" class="btn btn-danger" onclick="deleteSponsor('+results.data.sponsor_id+');">Delete</button>'
	  		
	  		$("#sponsorTable").append('<tr id="'+results.sponsor_id+'""><td>' + results.sponsor_id + '</td><td>' + i1 + '</td><td>' + i4 + '</td></tr>');
			$("#newName").val('');
	  	}else{
	  		alert('Sponsor was not added correctly', result.failures);
	  	}
	    console.log(results	)
	  }, error: function(request, error){
        alert("Error-> check console");
        console.log(request);
        console.log(error);
    } 
	});
}

function change(id, cat){
	if (!(id  in updates)){
		updates[id] = {}
	}
	updates[id][cat] = $('#' + id + '_' + cat).val();
	$('#updateButton').attr('disabled', false);
	console.log(updates);
}

function deleteSponsor(id){
	console.log("Fucker");
	var data = { "id": id};
	$.ajax
	({
	  type: "DELETE",
	  url: "{{route.sponsor}}/"+id,
	  contentType: "application/json",
	  dataType: 'json',
	  async: false,
	  username: '{{admin}}',
	  password: '{{password}}',
	  data: JSON.stringify(data),
      dataType: "json",
	  success: function (results){
	  	if (results.success == true){
	  		alert('Sponsor was removed successfully');
	  		$('#'+id).remove();
	  	}else{
	  		alert('sponsor was not removed', result.failures);
	  	}
	    console.log(results	)
	  }, error: function(request, error){
        alert("Error-> check console");
        console.log(request.text);
        console.log(error);
    } 
	});
}

function putSponsors(){
	for (var id in updates){
		putSponsor(id, updates[id]);
	}
}
function putSponsor(id, attributes){
	console.log("Fucker", attributes);
	console.log(id);
	$.ajax
	({
	  type: "PUT",
	  url: "{{route.sponsor}}/"+id,
	  contentType: "application/json",
	  dataType: 'json',
	  async: false,
	  username: '{{admin}}',
	  password: '{{password}}',
	  data: JSON.stringify(attributes),
      dataType: "json",
	  success: function (results){
	  	if (results.success == true){
	  		alert('sponsor was updated successfully');
	  	}else{
	  		alert('sponsor was not updated properly', result.failures);
	  	}
	    console.log(results)
	  }, error: function(request, error){
        alert("Error-> check console");
        console.log(request.text);
        console.log(error);
    } 
	});
}

</script>
{% endblock %}